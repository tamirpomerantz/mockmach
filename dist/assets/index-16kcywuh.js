(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const i of e)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function o(e){const i={};return e.integrity&&(i.integrity=e.integrity),e.referrerPolicy&&(i.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?i.credentials="include":e.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(e){if(e.ep)return;e.ep=!0;const i=o(e);fetch(e.href,i)}})();class M{constructor(t){this.ctx=t}drawImage(t,o,a="source-over",e=!1){if(!t||o.length!==4)return;const i=document.createElement("canvas"),s=i.getContext("2d",{willReadFrequently:!0});s.imageSmoothingEnabled=!0,this.ctx.imageSmoothingEnabled=!0,e?(s.imageSmoothingQuality="high",this.ctx.imageSmoothingQuality="high"):(s.imageSmoothingQuality="medium",this.ctx.imageSmoothingQuality="medium");const n=this.getBoundingBox(o),c=e?2:1;i.width=n.width*c,i.height=n.height*c;const r=[{x:0,y:0},{x:t.width,y:0},{x:t.width,y:t.height},{x:0,y:t.height}],l=o.map(g=>({x:(g.x-n.minX)*c,y:(g.y-n.minY)*c})),d=this.computeHomography(r,l),f=this.invertMatrix(d),h=s.createImageData(i.width,i.height),m=document.createElement("canvas");m.width=t.width,m.height=t.height;const u=m.getContext("2d");u.imageSmoothingEnabled=!0,u.imageSmoothingQuality=e?"high":"medium",u.drawImage(t,0,0);const b=u.getImageData(0,0,t.width,t.height).data;for(let g=0;g<i.height;g++)for(let E=0;E<i.width;E++)if(e){const p=this.getSamplePoints(E,g,2);let y=0,v=0,S=0,C=0,w=0;if(p.forEach(x=>{const k=this.applyHomography(f,x.x,x.y);if(k.x>=0&&k.x<t.width&&k.y>=0&&k.y<t.height){const L=this.bilinearInterpolation(b,t.width,k.x,k.y);y+=L.r,v+=L.g,S+=L.b,C+=L.a,w++}}),w>0){const x=(g*i.width+E)*4;h.data[x]=y/w,h.data[x+1]=v/w,h.data[x+2]=S/w,h.data[x+3]=C/w}}else{const p=this.applyHomography(f,E,g);if(p.x>=0&&p.x<t.width&&p.y>=0&&p.y<t.height){const y=this.bilinearInterpolation(b,t.width,p.x,p.y),v=(g*i.width+E)*4;h.data[v]=y.r,h.data[v+1]=y.g,h.data[v+2]=y.b,h.data[v+3]=y.a}}s.putImageData(h,0,0);const I=this.ctx.globalCompositeOperation;this.ctx.globalCompositeOperation=a,this.ctx.drawImage(i,0,0,i.width,i.height,n.minX,n.minY,n.width,n.height),this.ctx.globalCompositeOperation=I}getSamplePoints(t,o,a){const e=[],i=1/a;for(let s=0;s<a;s++)for(let n=0;n<a;n++)e.push({x:t+n*i,y:o+s*i});return e}computeHomography(t,o){const a=[],e=[];for(let s=0;s<4;s++){const n=t[s],c=o[s];a.push([n.x,n.y,1,0,0,0,-n.x*c.x,-n.y*c.x]),a.push([0,0,0,n.x,n.y,1,-n.x*c.y,-n.y*c.y]),e.push(c.x),e.push(c.y)}const i=this.solveEquations(a,e);return[[i[0],i[1],i[2]],[i[3],i[4],i[5]],[i[6],i[7],1]]}invertMatrix(t){const[[o,a,e],[i,s,n],[c,r,l]]=t,d=o*(s*l-n*r)-a*(i*l-n*c)+e*(i*r-s*c);return[[(s*l-n*r)/d,(e*r-a*l)/d,(a*n-e*s)/d],[(n*c-i*l)/d,(o*l-e*c)/d,(e*i-o*n)/d],[(i*r-s*c)/d,(a*c-o*r)/d,(o*s-a*i)/d]]}applyHomography(t,o,a){const e=t[2][0]*o+t[2][1]*a+t[2][2];return{x:(t[0][0]*o+t[0][1]*a+t[0][2])/e,y:(t[1][0]*o+t[1][1]*a+t[1][2])/e}}bilinearInterpolation(t,o,a,e){const i=Math.floor(a),s=Math.floor(e),n=Math.ceil(a),c=Math.ceil(e),r=a-i,l=e-s,d=(b,I)=>{b=Math.max(0,Math.min(o-1,b)),I=Math.max(0,Math.min(t.length/4/o-1,I));const g=(I*o+b)*4;return{r:t[g],g:t[g+1],b:t[g+2],a:t[g+3]}},f=d(i,s),h=d(n,s),m=d(i,c),u=d(n,c);return{r:this.bilerp(f.r,h.r,m.r,u.r,r,l),g:this.bilerp(f.g,h.g,m.g,u.g,r,l),b:this.bilerp(f.b,h.b,m.b,u.b,r,l),a:this.bilerp(f.a,h.a,m.a,u.a,r,l)}}bilerp(t,o,a,e,i,s){const n=t*(1-i)+o*i,c=a*(1-i)+e*i;return Math.round(n*(1-s)+c*s)}getBoundingBox(t){const o=t.map(c=>c.x),a=t.map(c=>c.y),e=Math.floor(Math.min(...o)),i=Math.ceil(Math.max(...o)),s=Math.floor(Math.min(...a)),n=Math.ceil(Math.max(...a));return{minX:e,minY:s,width:i-e,height:n-s}}solveEquations(t,o){const a=t.length,e=t.map((s,n)=>[...s,o[n]]);for(let s=0;s<a;s++){let n=s;for(let c=s+1;c<a;c++)Math.abs(e[c][s])>Math.abs(e[n][s])&&(n=c);[e[s],e[n]]=[e[n],e[s]];for(let c=s+1;c<a;c++){const r=e[c][s]/e[s][s];for(let l=s;l<=a;l++)e[c][l]-=r*e[s][l]}}const i=new Array(a).fill(0);for(let s=a-1;s>=0;s--){let n=e[s][a];for(let c=s+1;c<a;c++)n-=e[s][c]*i[c];i[s]=n/e[s][s]}return i}calculateInitialCornerPoints(t,o){const e=o.width-100,i=o.height-50*2;let s=t.width,n=t.height;if(s>e||n>i){const c=Math.min(e/s,i/n);s*=c,n*=c}return[{x:50,y:50},{x:50+s,y:50},{x:50+s,y:50+n},{x:50,y:50+n}]}}class R{constructor(){this.canvas=document.getElementById("mainCanvas"),this.ctx=this.canvas.getContext("2d"),this.backgroundImage=null,this.screenLayers=[],this.selectedPoint=null,this.selectedLayer=null,this.isDragging=!1,this.mockupPaths=[],this.imageTransformer=new M(this.ctx),this.canvas.width=1e3,this.canvas.height=800,this.loadMockupGallery(),this.setupEventListeners()}loadMockupGallery(){var o;this.mockupPaths=["mockups/visualelectric-1748261259770.png","mockups/visualelectric-1748261266492.png","mockups/visualelectric-1748261276540.png","mockups/visualelectric-1748261295616.png","mockups/visualelectric-1748261304335.png","mockups/visualelectric-1748261318253.png","mockups/visualelectric-1748261328063.png","mockups/visualelectric-1748261339097.png","mockups/visualelectric-1748261346321.png","mockups/visualelectric-1748261360450.png","mockups/visualelectric-1748261384867.png","mockups/visualelectric-1748261422033.png","mockups/visualelectric-1748261433395.png","mockups/visualelectric-1748261447102.png","mockups/visualelectric-1748261456859.png","mockups/visualelectric-1748261461437.png","mockups/visualelectric-1748261468448.png","mockups/visualelectric-1748261504179.png","mockups/visualelectric-1748261509897.png","mockups/visualelectric-1748261516935.png","mockups/visualelectric-1748261524835.png","mockups/visualelectric-1748261537147.png","mockups/visualelectric-1748261544027.png","mockups/visualelectric-1748261549724.png","mockups/visualelectric-1748261554937.png","mockups/visualelectric-1748261564086.png"];const t=document.getElementById("mockupGallery");this.mockupPaths.forEach((a,e)=>{const i=document.createElement("div");i.className="mockup-thumbnail";const s=document.createElement("img");s.src=a,s.alt=`Mockup ${e+1}`,i.appendChild(s),t.appendChild(i),i.addEventListener("click",()=>{document.querySelectorAll(".mockup-thumbnail").forEach(n=>{n.classList.remove("selected")}),i.classList.add("selected"),this.loadBackgroundImage(a)})}),this.mockupPaths.length>0&&(this.loadBackgroundImage(this.mockupPaths[0]),(o=t.firstElementChild)==null||o.classList.add("selected"))}loadBackgroundImage(t){const o=new Image;o.onload=()=>{const a=this.ctx.globalCompositeOperation;this.backgroundImage=o,this.canvas.width=o.width,this.canvas.height=o.height,this.ctx.globalCompositeOperation=a,this.render()},o.src=t}setupEventListeners(){document.getElementById("addImageButton").addEventListener("click",()=>{const t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=o=>this.loadScreenImage(o),t.click()}),document.querySelectorAll(".blend-mode-option").forEach(t=>{t.addEventListener("click",o=>{const a=o.target.dataset.mode;document.querySelectorAll(".blend-mode-option").forEach(e=>{e.classList.remove("active")}),o.target.classList.add("active"),this.selectedLayer!==null?this.screenLayers[this.selectedLayer].blendMode=a:this.screenLayers.forEach(e=>{e.blendMode=a}),this.render()})}),document.querySelector('.blend-mode-option[data-mode="source-over"]').classList.add("active"),this.canvas.addEventListener("mousedown",t=>this.handleMouseDown(t)),this.canvas.addEventListener("mousemove",t=>this.handleMouseMove(t)),this.canvas.addEventListener("mouseup",()=>this.handleMouseUp()),this.canvas.addEventListener("mouseleave",()=>this.handleMouseUp()),document.getElementById("downloadButton").addEventListener("click",()=>this.downloadImage()),document.getElementById("copyButton").addEventListener("click",()=>this.copyToClipboard()),document.addEventListener("paste",t=>this.handlePaste(t)),document.addEventListener("dragover",t=>{t.preventDefault(),t.stopPropagation(),document.body.classList.add("dragging")}),document.addEventListener("dragleave",t=>{t.preventDefault(),t.stopPropagation(),document.body.classList.remove("dragging")}),document.addEventListener("drop",t=>{t.preventDefault(),t.stopPropagation(),document.body.classList.remove("dragging"),this.handleDrop(t)}),document.addEventListener("keydown",t=>{(t.key==="Delete"||t.key==="Backspace")&&this.selectedLayer!==null&&(this.screenLayers.splice(this.selectedLayer,1),this.selectedLayer=null,this.selectedPoint=null,this.render())})}handlePaste(t){var a;const o=(a=t.clipboardData)==null?void 0:a.items;if(o){for(let e=0;e<o.length;e++)if(o[e].type.indexOf("image")!==-1){const i=o[e].getAsFile();this.processScreenImageFile(i);break}}}handleDrop(t){var a,e;const o=((a=t.dataTransfer)==null?void 0:a.items)||((e=t.dataTransfer)==null?void 0:e.files);if(o){if(o instanceof DataTransferItemList){for(let i=0;i<o.length;i++)if(o[i].type.indexOf("image")!==-1){const s=o[i].getAsFile();this.processScreenImageFile(s);break}}else for(let i=0;i<o.length;i++)if(o[i].type.indexOf("image")!==-1){this.processScreenImageFile(o[i]);break}}}processScreenImageFile(t){if(!t)return;const o=new FileReader;o.onload=a=>{const e=new Image;e.onload=()=>{const i={image:e,cornerPoints:this.imageTransformer.calculateInitialCornerPoints(e,this.canvas),blendMode:"source-over"};this.screenLayers.push(i),this.render()},e.src=a.target.result},o.readAsDataURL(t)}loadScreenImage(t){const o=t.target.files[0];o&&this.processScreenImageFile(o)}getMousePos(t){const o=this.canvas.getBoundingClientRect(),a=this.canvas.width/o.width,e=this.canvas.height/o.height;return{x:(t.clientX-o.left)*a,y:(t.clientY-o.top)*e}}handleMouseDown(t){const o=this.getMousePos(t),e=24/2;for(let i=0;i<this.screenLayers.length;i++){const s=this.screenLayers[i];for(let n=0;n<s.cornerPoints.length;n++){const c=s.cornerPoints[n];if(o.x>=c.x-e&&o.x<=c.x+e&&o.y>=c.y-e&&o.y<=c.y+e){this.selectedLayer=i,this.selectedPoint=n,this.isDragging=!0;const r=document.getElementById("blendMode");r.value=s.blendMode,this.render();return}}}this.selectedLayer=null,this.selectedPoint=null,this.render()}handleMouseMove(t){if(this.isDragging&&this.selectedLayer!==null&&this.selectedPoint!==null){const o=this.getMousePos(t);this.screenLayers[this.selectedLayer].cornerPoints[this.selectedPoint]=o,this.render()}}handleMouseUp(){this.isDragging=!1}drawCornerPoints(){const i=this.ctx.globalCompositeOperation;this.ctx.globalCompositeOperation="source-over",this.screenLayers.forEach((s,n)=>{this.ctx.beginPath(),this.ctx.moveTo(s.cornerPoints[0].x,s.cornerPoints[0].y);for(let c=1;c<s.cornerPoints.length;c++)this.ctx.lineTo(s.cornerPoints[c].x,s.cornerPoints[c].y);this.ctx.closePath(),this.ctx.strokeStyle="black",this.ctx.lineWidth=1,this.ctx.stroke(),s.cornerPoints.forEach((c,r)=>{this.ctx.save(),this.ctx.strokeStyle="black",this.ctx.lineWidth=1,this.ctx.strokeRect(c.x-12,c.y-12,24,24),this.ctx.beginPath(),this.ctx.arc(c.x,c.y,1.5,0,Math.PI*2),this.ctx.fillStyle="black",this.ctx.fill(),this.selectedLayer===n&&this.selectedPoint===r&&(this.ctx.strokeStyle="#FFF",this.ctx.lineWidth=2,this.ctx.strokeRect(c.x-12-2,c.y-12-2,28,28)),this.ctx.restore()})}),this.ctx.globalCompositeOperation=i}render(t=!1){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.backgroundImage&&this.ctx.drawImage(this.backgroundImage,0,0,this.canvas.width,this.canvas.height),this.screenLayers.forEach(o=>{this.imageTransformer.drawImage(o.image,o.cornerPoints,o.blendMode,!1)}),t||this.drawCornerPoints()}downloadImage(){const t=document.createElement("canvas");t.width=this.canvas.width,t.height=this.canvas.height;const o=t.getContext("2d"),a=new M(o);this.backgroundImage&&o.drawImage(this.backgroundImage,0,0,t.width,t.height),this.screenLayers.forEach(s=>{a.drawImage(s.image,s.cornerPoints,s.blendMode,!0)});const e=document.createElement("a"),i=new Date().toISOString().replace(/[:.]/g,"-");e.download=`mockup-${i}.png`,t.toBlob(s=>{const n=URL.createObjectURL(s);e.href=n,e.click(),URL.revokeObjectURL(n)},"image/png")}async copyToClipboard(){try{const t=document.createElement("canvas");t.width=this.canvas.width,t.height=this.canvas.height;const o=t.getContext("2d"),a=new M(o);this.backgroundImage&&o.drawImage(this.backgroundImage,0,0,t.width,t.height),this.screenLayers.forEach(r=>{a.drawImage(r.image,r.cornerPoints,r.blendMode,!0)});const e=await new Promise(r=>t.toBlob(r,"image/png")),i=new ClipboardItem({"image/png":e});await navigator.clipboard.write([i]);const s=document.getElementById("copyButton"),n=s.querySelector(".material-icons"),c=n.textContent;s.classList.add("success"),n.textContent="check",setTimeout(()=>{s.classList.remove("success"),n.textContent=c},2e3)}catch(t){console.error("Failed to copy:",t),alert("Failed to copy image to clipboard. Your browser may not support this feature.")}}}window.addEventListener("load",()=>{new R});
